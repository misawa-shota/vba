Attribute VB_Name = "Module2"
Option Explicit
Dim num As Integer


Sub テスト()

  ' 追加したい項目を入力するボックスの表示
  Dim newTitle As String
  newTitle = InputBox(" 追加したい項目名を入力して下さい ")
  
  ' ボックスに項目名が入力された時のみ以下の処理を実行
  If Not IsEmpty(newTitle) Then
    
    ' 商品のワークシートにのみ以下の処理を繰り返し実行
    Dim ws As Worksheet
    
    For Each ws In ThisWorkbook.Worksheets
      ws.Select
      Select Case ws.name
        Case "写真"
           ' 処理対象外なので、処理なし
           
        Case "グラフ"
        ' グラフシートに新しい項目を追加する処理
        Dim graphSheet As Worksheet
        Set graphSheet = Worksheets("グラフ")
        
        ' 既存の「異物の種類と発生件数」のグラフを削除
        Dim chartObj As ChartObject
        For Each chartObj In graphSheet.ChartObjects
          chartObj.Select
          If chartObj.chart.chartTitle.Text = "異物の種類と発生件数" Then
            chartObj.Delete
          End If
        Next

        Dim n As Long
        For n = 1 To 100

          If IsEmpty(graphSheet.Cells(6, n).Value) Then
            graphSheet.Cells(6, n).Value = newTitle
            graphSheet.range(Cells(7, n - 1), Cells(7, n - 1)).AutoFill Destination:=graphSheet.range(Cells(7, n - 1), Cells(7, n)), Type:=xlFillDefault

            graphSheet.Cells(6, n).Borders(xlEdgeTop).Weight = xlThin
            graphSheet.Cells(6, n).Borders(xlEdgeRight).Weight = xlThin
            graphSheet.Cells(6, n).Borders(xlEdgeBottom).LineStyle = xlDouble

            graphSheet.Cells(6, n).HorizontalAlignment = xlCenter
            graphSheet.Cells(6, n).VerticalAlignment = xlCenter

            Dim stringLength As Integer
            stringLength = Len(newTitle)
            If stringLength > 7 Then
              graphSheet.Columns(n).AutoFit
            End If
            
            ' 異物の種類と発生件数のグラフを自動作成
            ' 新たに「異物の種類と発生件数」のグラフを作成
            With graphSheet.Shapes.AddChart2.chart
              .HasTitle = True
              .chartTitle.Text = "異物の種類と発生件数"
              .ChartType = xlColumnClustered
              .SetSourceData range(Cells(6, "B"), Cells(7, n))
              
              ' 縦軸のラベルを表示
              With .Axes(xlValue)
                    .HasTitle = True
                    .AxisTitle.Text = "発生件数"
                    .AxisTitle.Orientation = xlVertical
              End With
              
              ' 横軸のラベル名を水平に設定
              With .Axes(xlCategory)
                    .TickLabels.Orientation = xlHorizontal
              End With
              
              ' グラフの表示位置とサイズの設定
              With ActiveSheet.ChartObjects
                    .Top = range("A10").Top
                    .Left = range("A10").Left
                    .Height = 300
                    .Width = 1000
              End With
            End With
            Exit For
          End If
        Next n
             
        Case Else
          ' 商品のシートにのみ以下の処理を実行
          Dim i As Long
          For i = 1 To 100
          
            ' 項目を追加する処理
            If IsEmpty(Cells(6, i).Value) Then
            
              '  新規項目の列を追加する処理
              Cells(6, i).Value = newTitle
              range(Cells(7, i - 1), Cells(35, i - 1)).AutoFill Destination:=range(Cells(7, i - 1), Cells(35, i)), Type:=xlFillDefault
              
              '  テーブルの枠線の指定
              range(Cells(7, i), Cells(35, i)).Borders(xlEdgeLeft).Weight = xlThin
              Cells(6, i).Borders(xlEdgeTop).Weight = xlMedium
              Cells(6, i).Borders(xlEdgeRight).Weight = xlMedium
              Cells(6, i).Borders(xlEdgeLeft).Weight = xlThin
              
              '  新規追した加項目のセル内の配置の指定
              Cells(6, i).HorizontalAlignment = xlCenter
              Cells(6, i).VerticalAlignment = xlCenter
              
              ' 新規追加した列の幅を調整する
              Dim length As Integer
              length = Len(newTitle)
      
              If length > 7 Then
                Columns(i).AutoFit
              End If
              
               ' 新規追加した列のデータ入力範囲内のデータを空にする処理（オートフィルで隣のデータをコピーするため）
              range(Cells(8, i), Cells(35, i)).Value = ""
              
              Exit For
            End If
            
          Next i
      End Select
    Next ws
  End If
End Sub


Sub セル値_配列に追加()

  Dim targetRange As range
  Dim arr() As Variant '動的配列を宣言
  Dim i As Long, j As Long
  Dim lastRow As Long, lastCol As Long

  ' 配列に追加する範囲を指定
  Set targetRange = ThisWorkbook.Sheets("グラフ").range("A1:C10") ' 例: Sheet1のA1からC10

  ' 配列のサイズを決定
  lastRow = targetRange.Rows.Count
  lastCol = targetRange.Columns.Count
  ReDim arr(1 To lastRow, 1 To lastCol)

  ' セル値を配列に格納
  For i = 1 To lastRow
    For j = 1 To lastCol
      arr(i, j) = targetRange.Cells(i, j).Value
    Next j
  Next i

  ' ここで配列arrを使用
  ' 例: 配列の内容をメッセージボックスに表示
  Dim output As String
  For i = 1 To lastRow
      For j = 1 To lastCol
          output = output & arr(i, j) & vbTab
      Next j
      output = output & vbNewLine
  Next i
  MsgBox output

End Sub


Sub 項目を配列に追加()

  Dim range As range
  Dim cell As range
  
  Set range = ActiveSheet.range(Cells(6, 2), Cells(6, 100))
  Set range = range.SpecialCells(xlCellTypeConstants)
  
  For Each cell In range
    Debug.Print cell.Address, cell.Value
  Next cell
  
End Sub
